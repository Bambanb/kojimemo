<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>繝｡繝｢</title>
  <style>
    :root{
      --bg:#202124;
      --panel:#2b2d31;
      --panel2:#26282c;
      --text:#e8eaed;
      --muted:#a9adb6;
      --line:rgba(255,255,255,.08);
      --accent:#8ab4f8;
      --danger:#ff6b6b;
      --radius:16px;
    }
    *{box-sizing:border-box}

    /* 譖ｴ譁ｰ繝�せ繝� */
    
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      position:sticky;top:0;z-index:10;
      padding:14px 14px 10px;
      background:linear-gradient(to bottom, rgba(32,33,36,.96), rgba(32,33,36,.70));
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .row{display:flex;align-items:center;gap:10px}
    .between{justify-content:space-between}
    .title{
      font-weight:700;
      letter-spacing:.02em;
      font-size:18px;
    }
    .crumb{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      font-weight:650;
      font-size:14px;
      line-height:1;
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btn.accent{border-color:rgba(138,180,248,.35); background:rgba(138,180,248,.12); color:var(--accent)}
    .btn.danger{border-color:rgba(255,107,107,.35); background:rgba(255,107,107,.10); color:var(--danger)}
    .btn.icon{padding:10px 12px; min-width:44px; text-align:center}
    .pill{
      flex:1;
      display:flex; align-items:center; gap:8px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:16px;
      padding:10px 12px;
      min-width:0;
    }
    .pill input{
      width:100%;
      border:0; outline:0;
      background:transparent;
      color:var(--text);
      font-size:14px;
      min-width:0;
    }
    main{padding:12px 14px 80px}
    .panel{
      background:rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      margin:12px 0;
    }
    .panel h3{
      margin:0 0 10px;
      font-size:13px;
      color:var(--muted);
      font-weight:700;
      letter-spacing:.06em;
    }
    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 14px;
      border-radius:14px;
      background:rgba(255,255,255,.03);
      border:1px solid var(--line);
      margin:10px 0;
    }
    .item:active{transform:translateY(1px)}
    .left{display:flex;align-items:center;gap:10px;min-width:0}
    .ico{font-size:16px; opacity:.9}
    .name{
      font-weight:700;
      font-size:15px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      min-width:0;
    }
    .meta{
      display:flex;align-items:center;gap:10px;
      color:var(--muted);
      font-size:12px;
      flex-shrink:0;
    }
    .meta span{opacity:.9}
    .arrow{color:var(--muted); opacity:.7}
    .fab{
      position:fixed; right:16px; bottom:18px;
      display:flex; gap:10px;
      z-index:20;
    }
    .fab .btn{border-radius:18px; padding:12px 14px}
    /* editor */
    #editorView{
      position:fixed; inset:0;
      background:var(--bg);
      display:none;
      flex-direction:column;
      z-index:50;
    }
    #editorTop{
      position:sticky; top:0;
      padding:14px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(to bottom, rgba(32,33,36,.98), rgba(32,33,36,.78));
      backdrop-filter: blur(10px);
    }
    #editorTop .small{color:var(--muted); font-size:12px}
    #titleInput{
      width:100%;
      margin-top:10px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--text);
      border-radius:14px;
      padding:12px 12px;
      font-size:15px;
      outline:none;
      font-weight:700;
    }
    #bodyInput{
      flex:1;
      width:100%;
      border:0;
      outline:none;
      resize:none;
      background:transparent;
      color:var(--text);
      padding:14px;
      font-size:15px;
      line-height:1.7;
    }
    .spacer{height:8px}
    .hint{color:var(--muted); font-size:12px}
    /* custom dialog */
    #customDialog{
      position:fixed; inset:0;
      background:rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
    }
    #dialogBox{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:20px;
      max-width:90vw;
      width:340px;
    }
    #dialogTitle{
      font-size:16px;
      font-weight:700;
      margin-bottom:12px;
      color:var(--text);
    }
    #dialogMessage{
      font-size:14px;
      color:var(--muted);
      margin-bottom:20px;
      line-height:1.5;
    }
    #dialogButtons{
      display:flex;
      gap:10px;
      justify-content:flex-end;
    }
  </style>
</head>
<body>
  <header>
    <div class="row between">
      <div class="row" style="min-width:0">
        <button class="btn icon" id="backBtn" title="荳翫∈">竊�</button>
        <div style="min-width:0">
          <div class="title" id="headTitle" data-i18n="繝帙�繝�">繝帙�繝�</div>
          <div class="crumb" id="breadcrumb">/</div>
        </div>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="row">

<div class="row">
  <button class="btn icon" id="modeBtn" title="繝｢繝ｼ繝牙�譖ｿ">蠕�</button>
</div>
      
      <div class="pill">
        <span class="ico">笨�</span>
        <input id="qInput" data-ph="繧ｿ繧､繝医Ν/譛ｬ譁��荳驛ｨ�井ｻｻ諢擾ｼ�" placeholder="繧ｿ繧､繝医Ν/譛ｬ譁��荳驛ｨ�井ｻｻ諢擾ｼ�" />
      </div>
      <button class="btn" id="renameFolderBtn" data-i18n="繝輔か繝ｫ繝蜷榊､画峩">繝輔か繝ｫ繝蜷榊､画峩</button>
    </div>
  </header>

<main>
  <div class="panel" id="foldersPanel">
    <h3 data-i18n="繝輔か繝ｫ繝">繝輔か繝ｫ繝</h3>
    <div id="foldersList"></div>
    <div class="hint" id="foldersEmpty" style="display:none;" data-i18n="繝輔か繝ｫ繝縺ｪ縺�">繝輔か繝ｫ繝縺ｪ縺�</div>
  </div>

  <div class="panel" id="memosPanel">
    <h3 data-i18n="繝｡繝｢">繝｡繝｢</h3>
    <div id="memosList"></div>
    <div class="hint" id="memosEmpty" style="display:none;" data-i18n="繝｡繝｢縺ｪ縺�">繝｡繝｢縺ｪ縺�</div>
  </div>
</main>

  <div class="fab">
    <button class="btn accent" id="addMemoBtn" data-i18n="�九Γ繝｢">�九Γ繝｢</button>
<button class="btn accent" id="addFolderBtn" data-i18n="�愚沒�">�愚沒�</button>
    
  </div>

  <!-- editor -->
  <div id="editorView">
    <div id="editorTop">
      <div class="row between">
        <button class="btn" id="closeEditorBtn">竊�</button>
        <div class="small" id="charCount" data-i18n="譁�ｭ玲焚">譁�ｭ玲焚 0</div>
        <div class="row" style="gap:8px">
          <div class="small" id="saveStatus" style="color:var(--muted)" data-i18n="菫晏ｭ俶ｸ医∩">菫晏ｭ俶ｸ医∩</div>
          <button class="btn" id="backToListBtn" data-i18n="謌ｻ繧�">謌ｻ繧�</button>
        </div>
      </div>
      <input id="titleInput" data-ph="繧ｿ繧､繝医Ν" placeholder="繧ｿ繧､繝医Ν" />
      <textarea id="bodyInput" data-ph="縺薙％縺ｫ譛ｬ譁�ｒ譖ｸ縺上�" placeholder="縺薙％縺ｫ譛ｬ譁�ｒ譖ｸ縺上�"></textarea>
    </div>
  </div>

  <!-- custom dialog -->
  <div id="customDialog">
    <div id="dialogBox">
      <div id="dialogTitle"></div>
      <div id="dialogMessage"></div>
      <div id="dialogButtons"></div>
    </div>
  </div>

<script>
/** ========= 險ｭ螳� ========= */
const CONFIG = {
  showMemosOnTop: true,   // 竊舌後Γ繝｢荳隕ｧ縺�ｉ繧薙阪↑繧� false 縺ｫ縺吶ｋ�医ヵ繧ｩ繝ｫ繝縺�縺題｡ｨ遉ｺ��
  autosaveMs: 600,        // 閾ｪ蜍穂ｿ晏ｭ倬俣髫�
  storageKey: "memoTreeV2_notaUI"
};

/** ========= 繝��繧ｿ =========
node = { folders:{name:node}, memos:{id:{id,title,text,updatedAt}} }
*/
function newNode(){ return { folders:{}, memos:{} }; }
function now(){ return Date.now(); }
function uid(){ return "m_" + Math.random().toString(36).slice(2) + "_" + now().toString(36); }

let root = load() || newNode();
let path = [];                 // ["逧�｢ｯ", "遏ｭ邱ｨ", ...]
let editingId = null;
let autosaveTimer = null;

const el = (id)=>document.getElementById(id);

function load(){
  try{
    const s = localStorage.getItem(CONFIG.storageKey);
    if(!s) return null;
    return JSON.parse(s);
  }catch(e){ return null; }
}
function persist(){
  try{
    localStorage.setItem(CONFIG.storageKey+"_bak", JSON.stringify(root));
    localStorage.setItem(CONFIG.storageKey, JSON.stringify(root));
  }catch(e){
    alert("菫晏ｭ倥〒縺阪∪縺帙ｓ縺ｧ縺励◆�医せ繝医Ξ繝ｼ繧ｸ荳企剞縺ｪ縺ｩ��");
  }
}
function getNode(p = path){
  let node = root;
  for(const name of p){
    if(!node.folders[name]) node.folders[name] = newNode();
    node = node.folders[name];
  }
  return node;
}
function getParentNode(){
  return getNode(path.slice(0, -1));
}
function folderCharSum(node){
  let sum = 0;
  for(const id in node.memos){
    sum += (node.memos[id].text || "").length;
  }
  for(const fname in node.folders){
    sum += folderCharSum(node.folders[fname]);
  }
  return sum;
}

function setCrumb(){
  el("headTitle").textContent = path.length ? path[path.length-1] : "繝帙�繝�";
  el("breadcrumb").textContent = "/" + path.join("/");
  el("backBtn").disabled = path.length === 0;
}

function render(){
  setCrumb();
  const node = getNode();
  const q = (el("qInput").value || "").trim().toLowerCase();

  // folders
  const folders = Object.keys(node.folders).sort((a,b)=>a.localeCompare(b,"ja"));
  const foldersList = el("foldersList");
  foldersList.innerHTML = "";
  let folderShown = 0;
  for(const name of folders){
    // search filter: if q exists, folder is shown if anything inside matches (cheap: always show folders when q empty)
    if(q){
      // quick check: if folder has memos containing q in title/text
      const sub = node.folders[name];
      const hit = hasHitInFolder(sub, q);
      if(!hit) continue;
    }
    folderShown++;

    const sub = node.folders[name];
    const memoCount = Object.keys(sub.memos).length;
    const charSum = folderCharSum(sub);

    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left" style="min-width:0">
        <div class="ico">刀</div>
        <div class="name" title="${escapeHtml(name)}">${escapeHtml(name)}</div>
      </div>
      <div class="meta">
      <span>${t("譁�ｭ玲焚")} ${charSum}</span>
        <span>統 ${memoCount}</span>
        <span>譁�ｭ� ${charSum}</span>
        <span class="arrow">窶ｺ</span>
      </div>
    `;
    let pressTimer;
    div.addEventListener("mousedown", ()=>{
      pressTimer = setTimeout(()=>deleteFolder(name), 500);
    });
    div.addEventListener("mouseup", ()=>clearTimeout(pressTimer));
    div.addEventListener("mouseleave", ()=>clearTimeout(pressTimer));
    div.addEventListener("touchstart", ()=>{
      pressTimer = setTimeout(()=>deleteFolder(name), 500);
    });
    div.addEventListener("touchend", ()=>clearTimeout(pressTimer));
    div.addEventListener("touchcancel", ()=>clearTimeout(pressTimer));
    div.addEventListener("click", ()=>{
      path.push(name);
      render();
    });
    foldersList.appendChild(div);
  }
  el("foldersEmpty").style.display = folderShown ? "none" : "block";

  // memos
  el("memosPanel").style.display = CONFIG.showMemosOnTop ? "block" : "none";
  if(CONFIG.showMemosOnTop){
    const memos = Object.values(node.memos)
      .sort((a,b)=>(b.updatedAt||0)-(a.updatedAt||0));
    const memosList = el("memosList");
    memosList.innerHTML = "";
    let memoShown = 0;

    for(const m of memos){
      const titleLower = (m.title||"").toLowerCase();
      const x = (m.text||"").toLowerCase();
      if(q && !(titleLower.includes(q) || x.includes(q))) continue;
      memoShown++;

      const preview = (m.text||"").replace(/\s+/g," ").slice(0,30);
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="left" style="min-width:0">
          <div class="ico">統</div>
          <div style="min-width:0">
            <div class="name" title="${escapeHtml(m.title||"(辟｡鬘�)")}">${escapeHtml(m.title||"(辟｡鬘�)")}</div>
            <div class="hint" style="margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:52vw;">
              ${escapeHtml(preview)}
            </div>
          </div>
        </div>
        <div class="meta">
        <span>${(m.text||"").length}${t("蟄�")}</span>
          <span class="arrow">窶ｺ</span>
        </div>
      `;
      let pressTimer;
      div.addEventListener("mousedown", ()=>{
        pressTimer = setTimeout(()=>deleteMemo(m.id), 500);
      });
      div.addEventListener("mouseup", ()=>clearTimeout(pressTimer));
      div.addEventListener("mouseleave", ()=>clearTimeout(pressTimer));
      div.addEventListener("touchstart", ()=>{
        pressTimer = setTimeout(()=>deleteMemo(m.id), 500);
      });
      div.addEventListener("touchend", ()=>clearTimeout(pressTimer));
      div.addEventListener("touchcancel", ()=>clearTimeout(pressTimer));
      div.addEventListener("click", ()=>openEditor(m.id));
      memosList.appendChild(div);
    }
    el("memosEmpty").style.display = memoShown ? "none" : "block";
  }
}

function hasHitInFolder(node, q){
  for(const id in node.memos){
    const m = node.memos[id];
    const titleLower = (m.title||"").toLowerCase();
    const x = (m.text||"").toLowerCase();
    if(titleLower.includes(q) || x.includes(q)) return true;
  }
  for(const name in node.folders){
    if(hasHitInFolder(node.folders[name], q)) return true;
  }
  return false;
}

function escapeHtml(s){
  return (s??"").replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[c]));
}

/** ========= 謫堺ｽ� ========= */
function goUp(){
  if(path.length>0){ path.pop(); render(); }
}
function addFolder(){
  const name = prompt(t("繝輔か繝ｫ繝蜷�"));
  if(!name) return;
  const node = getNode();
  if(node.folders[name]){ alert(t("蜷悟錐繝輔か繝ｫ繝縺後≠繧翫∪縺�")); return; }
  node.folders[name] = newNode();
  persist();
  render();
}
function addMemo(){
  const node = getNode();
  const id = uid();
  node.memos[id] = { id, title:"", text:"", updatedAt: now() };
  persist();
  openEditor(id);
}
function renameCurrentFolder(){
  if(path.length===0){ alert(t("繝帙�繝�縺ｯ螟画峩縺ｧ縺阪∪縺帙ｓ")); return; }
  const parent = getParentNode();
  const old = path[path.length-1];
  const nu = prompt(t("譁ｰ縺励＞繝輔か繝ｫ繝蜷�"), old);
  if(!nu || nu===old) return;
  if(parent.folders[nu]){ alert(t("蜷悟錐繝輔か繝ｫ繝縺後≠繧翫∪縺�")); return; }
  parent.folders[nu] = parent.folders[old];
  delete parent.folders[old];
  path[path.length-1] = nu;
  persist();
  render();
}
async function deleteCurrentFolder(){
  if(path.length===0){ alert(t("繝帙�繝�縺ｯ蜑企勁縺ｧ縺阪∪縺帙ｓ")); return; }
  const parent = getParentNode();
  const name = path[path.length-1];
  const ok = await showDialog(
    name,
    t("蜑企勁縺励∪縺吶°?"),
    [
      { text: t("謌ｻ繧�"), value: false },
      { text: t("螻�繧�"), value: true, danger: true }
    ]
  );
  if(!ok) return;
  delete parent.folders[name];
  path.pop();
  persist();
  render();
}
async function deleteMemo(id){
  const node = getNode();
  const m = node.memos[id];
  if(!m){ alert(t("繝｡繝｢縺瑚ｦ九▽縺九ｊ縺ｾ縺帙ｓ")); return; }
  
  const ok = await showDialog(
    m.title || t("(辟｡鬘�)"),
    t("逕溯ｴ��縺薙＞縺､縺�?"),
    [
      { text: t("騾縺�"), value: false },
      { text: t("螻�繧�"), value: true, danger: true }
    ]
  );
  if(!ok) return;
  delete node.memos[id];
  persist();
  render();
}
async function deleteFolder(name){
  const node = getNode();
  if(!node.folders[name]) return;
  
  const ok = await showDialog(
    name,
    t("蜑企勁縺励∪縺吶°?"),
    [
      { text: t("謌ｻ繧�"), value: false },
      { text: t("螻�繧�"), value: true, danger: true }
    ]
  );
  if(!ok) return;
  delete node.folders[name];
  persist();
  render();
}

/** ========= Editor ========= */
function openEditor(id){
  editingId = id;
  const node = getNode();
  const m = node.memos[id];
if(!m){ alert(t("繝｡繝｢縺瑚ｦ九▽縺九ｊ縺ｾ縺帙ｓ")); return; }
  
  el("titleInput").value = m.title || "";
  el("bodyInput").value = m.text || "";
  updateCharCount();

  el("editorView").style.display = "flex";

  // autosave
  clearInterval(autosaveTimer);
  autosaveTimer = setInterval(()=>saveMemo(true), CONFIG.autosaveMs);
  // focus
  setTimeout(()=>el("bodyInput").focus(), 60);
}
function closeEditor(){
  saveMemo(true);
  clearInterval(autosaveTimer);
  autosaveTimer = null;
  el("editorView").style.display = "none";
  editingId = null;
  render();
}
function updateCharCount(){
  el("charCount").textContent = "譁�ｭ玲焚 " + (el("bodyInput").value || "").length;
}
function showSaving(){
  const status = el("saveStatus");
  if(status) status.textContent = t("菫晏ｭ倅ｸｭ");
}
function showSaved(){
  const status = el("saveStatus");
  if(status) status.textContent = t("菫晏ｭ俶ｸ医∩");
}

/** ========= Custom Dialog ========= */
function showDialog(title, message, buttons){
  return new Promise((resolve)=>{
    const dialog = el("customDialog");
    const dialogTitle = el("dialogTitle");
    const dialogMessage = el("dialogMessage");
    const dialogButtons = el("dialogButtons");

    dialogTitle.textContent = title;
    dialogMessage.textContent = message;
    dialogButtons.innerHTML = "";

    buttons.forEach(btn=>{
      const button = document.createElement("button");
      button.className = btn.danger ? "btn danger" : "btn";
      button.textContent = btn.text;
      button.addEventListener("click", ()=>{
        dialog.style.display = "none";
        resolve(btn.value);
      });
      dialogButtons.appendChild(button);
    });

    dialog.style.display = "flex";
  });
}

function saveMemo(silent=false){
  if(!editingId) return;
  const node = getNode();
  const m = node.memos[editingId];
  if(!m) return;

  m.title = el("titleInput").value || "";
  m.text  = el("bodyInput").value || "";
  m.updatedAt = now();

  persist();
  showSaved();
  if(!silent) render();
}

/** ========= bind ========= */
/** ========= bind ========= */
el("backBtn")?.addEventListener("click", goUp);
el("addFolderBtn")?.addEventListener("click", addFolder);
el("addMemoBtn")?.addEventListener("click", addMemo);
el("renameFolderBtn")?.addEventListener("click", renameCurrentFolder);

el("closeEditorBtn")?.addEventListener("click", closeEditor);
el("backToListBtn")?.addEventListener("click", closeEditor);
el("qInput")?.addEventListener("input", ()=>render());
el("titleInput")?.addEventListener("input", showSaving);
el("bodyInput")?.addEventListener("input", ()=>{ updateCharCount(); showSaving(); });
/** ========= 繝｢繝ｼ繝� & 霎樊嶌 ========= */
const MODE_KEY = "memoTree_mode_kouki";
let koukiMode = localStorage.getItem(MODE_KEY) === "1";

const DICT_NORMAL = {
  // 縺薙％縺ｯ蠢�ｦ√↑繧牙�繧後ｋ�磯壼ｸｸ譎ゅ�陦ｨ險倥ｒ螟峨∴縺溘＞蝣ｴ蜷医�縺ｿ��
};

const DICT_KOUKI = {
  // 竭� 蜈ｱ騾啅I
  "繝帙�繝�":"繝帙�繝�",
  "菫晏ｭ�":"蜃ｦ逅�ｮ御ｺ�",
  "謌ｻ繧�":"騾縺�",
  "髢峨§繧�":"謦､蜿�",
  "讀懃ｴ｢":"邏｢謨ｵ",
  "繝輔か繝ｫ繝蜷榊､画峩":"迯ｲ迚ｩ蜷榊､画峩",
  "繝輔か繝ｫ繝蜑企勁":"螻�繧�",
  "繝輔か繝ｫ繝":"迯ｲ迚ｩ",
  "繝｡繝｢":"閧臥援",
  "繝輔か繝ｫ繝縺ｪ縺�":"莉募�繧悟燕",
  "繝｡繝｢縺ｪ縺�":"閻ｹ縺梧ｸ帙▲縺�",
  "�九Γ繝｢":"�玖ｧ｣菴�",
  "�愚沒�":"�倶ｻ慕蕗繧√ｋ",

  // editor
  "譁�ｭ玲焚":"驥埼㍼",
  "繧ｿ繧､繝医Ν":"蜻ｳ莉倥￠",
  "縺薙％縺ｫ譛ｬ譁�ｒ譖ｸ縺上�":"隗｣菴薙す繝ｧ繝ｼ縺ｮ蟋九∪繧翫□",

  // 讀懃ｴ｢陬懷勧
  "繧ｿ繧､繝医Ν/譛ｬ譁��荳驛ｨ�井ｻｻ諢擾ｼ�":"邏｢謨ｵ�井ｻｻ諢擾ｼ�",

  // 霑ｽ蜉�縺ｧ蠢�ｦ√↓縺ｪ繧翫′縺｡縺ｪ繧�▽
  "(辟｡鬘�)":"(辟｡鬘�)",

  // B 繝ｪ繝阪�繝�
  "蜷榊燕繧貞､画峩":"鬚ｨ蜻ｳ縺ｮ隱ｿ謨ｴ",
  "蜷榊燕繧貞､画峩縺励∪縺励◆":"蜻ｳ繧定ｪｿ謨ｴ縺励◆",

  // C 遶ｶ蜷�/荳頑嶌縺�
  "荳頑嶌縺阪＠縺ｾ縺励◆":"莉戊ｾｼ縺ｿ螳御ｺ�□",
  "螟画峩縺檎ｫｶ蜷医＠縺ｦ縺�∪縺�":"繧ｪ繝ｼ繝繝ｼ縺瑚｢ｫ縺｣縺�",

  // D 閾ｪ蜍穂ｿ晏ｭ倥せ繝��繧ｿ繧ｹ
  "菫晏ｭ倅ｸｭ":"菫ｺ縺ｮ迯ｲ迚ｩ縺�",
  "菫晏ｭ俶ｸ医∩":"辭滓�縺輔○繧�",

  // 竭､ 繝繧､繧｢繝ｭ繧ｰ鬘�
  "繝輔か繝ｫ繝蜷�":"迯ｲ迚ｩ蜷�",
  "譁ｰ縺励＞繝輔か繝ｫ繝蜷�":"陦逾ｭ繧翫↓荳翫￡繧�",
  "蜑企勁縺励∪縺吶°?":"逕溯ｴ��縺薙＞縺､縺�?",
  "菫晏ｭ倥〒縺阪∪縺帙ｓ縺ｧ縺励◆�医せ繝医Ξ繝ｼ繧ｸ荳企剞縺ｪ縺ｩ��":"辭滓�縺瑚ｶｳ繧翫�縺�",
  "蜷悟錐繝輔か繝ｫ繝縺後≠繧翫∪縺�":"蠑ｱ閧牙ｼｷ鬟溘□",
  "繝帙�繝�縺ｯ螟画峩縺ｧ縺阪∪縺帙ｓ":"邵�ｼｵ繧翫ｒ闕偵ｉ縺吶↑",
  "繝帙�繝�縺ｯ蜑企勁縺ｧ縺阪∪縺帙ｓ":"逕溘″縺ｦ蟶ｰ繧後ｋ縺ｨ諤昴≧縺ｪ",
  "繝｡繝｢縺瑚ｦ九▽縺九ｊ縺ｾ縺帙ｓ":"莉募�繧悟燕縺�"
};

function dict(){
  return koukiMode ? DICT_KOUKI : DICT_NORMAL;
}
function t(s){
  const d = dict();
  return d[s] ?? s;
}

// data-i18n 縺ｨ data-ph��placeholder�� 繧剃ｸ諡ｬ蜿肴丐
function applyDict(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    el.textContent = t(key);
  });
  document.querySelectorAll("[data-ph]").forEach(el=>{
    const key = el.getAttribute("data-ph");
    el.setAttribute("placeholder", t(key));
  });
  // 繧ｿ繧､繝医Ν繧� tooltip 繧ょｿ�ｦ√↑繧峨％縺薙〒
}

function toggleMode(){
  koukiMode = !koukiMode;
  localStorage.setItem(MODE_KEY, koukiMode ? "1" : "0");
  renderModeBtn();
  applyDict();
  render();
}

function renderModeBtn(){
  const btn = el("modeBtn");
  if(btn){
    btn.textContent = koukiMode ? "逧�" : "蠕�";
    btn.title = koukiMode ? "騾壼ｸｸ繝｢繝ｼ繝峨∈" : "逧�ｴ繝｢繝ｼ繝峨∈";
  }
}

// 繝｢繝ｼ繝牙�譖ｿ繝懊ち繝ｳ
if(el("modeBtn")) el("modeBtn").addEventListener("click", toggleMode);

// 蛻晄悄蛹�
renderModeBtn();
applyDict();
render();



  
</script>
</body>
</html>
